# "Getting and Cleaning Data" Course Project
Chuck Thompson  
Sunday, December 21, 2014  

Introduction
------------
This code book was produced for the "Getting and Cleaning Data" Coursera course
project that is described on the [course project webpage](https://class.coursera.org/getdata-016/human_grading/view/courses/973758/assessments/3/submissions).



Data Source
-----------
The data for the project was obtained from the UCI Machine Learning Repository.
It was collected from the accelerometers from the Samsung Galaxy S smartphone.
A full description is available at:

http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones

The data for the project is available at:

https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip


Raw Data Description
--------------------
Additional information about the original data set may be found in the files `README.txt` and `features_info.txt` which are included in it.

The original data includes two subsets of data, identically formatted, that are each a series of observations of a set of subjects performing a number of activities.  There are a total of 30 subjects combined in the two subsets.  Each observation record consists of 561 variables of different measurements from the accelerometer and gyroscope in the subject's smartphone.


Intermediate Tidy Data Set Description
--------------------------------------
An intermediate tidy data set is first created directly from the raw data.  It will be used to create the final data set.  This section describes the variables in this tidy data set.  For information on the process by which it is created from the raw data, see the section below about the run_analysis.R script.

The intermediate tidy data set contains 10299 observations with the following 69 variables:

* **Group**:  factor variable indicting data subset observation was in
    + test
    + train
* **Subject**:  integer variable identifying subject of observation
    + 1..30
* **Activity**:  factor variable describing activity perfomed during observation
    + WALKING
    + WALKING_UPSTAIRS
    + WALKING_DOWNSTAIRS
    + SITTING
    + STANDING
    + LAYING
* A 66-feature vector with time and frequency domain signal numeric variables.

These 66 variables are a subset of the 561 from the original data set.  Per
the requirements of the project, only the variables that included straight
mean or standard deviation values were included in the tidy set.  There are
some additional variables with different kinds of means (e.g. weighted) and
these were not included in this tidy data set.

The variable names are coded as follows:

* Signal type is indicated by the variable prefix.
    + **TimeDomain_**:  Raw signals captured from the accelerometer and gyroscope at a constant rate of 50 Hz which were then filtered using a median filter and a 3rd order low pass Butterworth filter with a corner frequency of 20 Hz to remove noise.
    + **FrequencyDomain_**:  Generated by application of a Fast Fourier Transform (FFT) to some of the TimeDomain signals.
* The type of acceleration signal follows the signal type prefix.  The original acceleration signals were separated using another low pass Butterworth filter with a corner frequency of 0.3 Hz.
    + **Body**
    + **Gravity**
* The device is next indicated by:
    + **Accelerometer**
    + **Gyroscope**
* Variables representing the body linear acceleration and angular velocity were derived in time to obtain Jerk signals.  These are indicated by:
    + **Jerk**
* The magnitude of the three-dimensional signals were calculated using the Euclidean norm.  These are indicated by the addition of:
    + **Magnitude**
* The type of variable (mean or standard deviation) is next indicated by:
    + **\_mean**
    + **\_std**
* Variables representing one of the 3-axial raw signals from the Accelerometer or Gyroscope then have a suffix added indicating which axis they represent:
    + **\_X**
    + **\_Y**
    + **\_Z**

The 66 variables included in the tidy data set that are coded as above are:

| Time Domain                         | Frequency Domain                        
| ------------------------------------|-----------------------------------------
| TimeDomain_BodyAccelerometer_mean_X | FrequencyDomain_BodyAccelerometer_mean_X |
| TimeDomain_BodyAccelerometer_mean_Y | FrequencyDomain_BodyAccelerometer_mean_Y |
| TimeDomain_BodyAccelerometer_mean_Z | FrequencyDomain_BodyAccelerometer_mean_Z |
| TimeDomain_BodyAccelerometer_std_X | FrequencyDomain_BodyAccelerometer_std_X |
| TimeDomain_BodyAccelerometer_std_Y | FrequencyDomain_BodyAccelerometer_std_Y |
| TimeDomain_BodyAccelerometer_std_Z | FrequencyDomain_BodyAccelerometer_std_Z |
| TimeDomain_GravityAccelerometer_mean_X | FrequencyDomain_BodyAccelerometerJerk_mean_X |
| TimeDomain_GravityAccelerometer_mean_Y | FrequencyDomain_BodyAccelerometerJerk_mean_Y |
| TimeDomain_GravityAccelerometer_mean_Z | FrequencyDomain_BodyAccelerometerJerk_mean_Z |
| TimeDomain_GravityAccelerometer_std_X | FrequencyDomain_BodyAccelerometerJerk_std_X |
| TimeDomain_GravityAccelerometer_std_Y | FrequencyDomain_BodyAccelerometerJerk_std_Y |
| TimeDomain_GravityAccelerometer_std_Z | FrequencyDomain_BodyAccelerometerJerk_std_Z |
| TimeDomain_BodyAccelerometerJerk_mean_X | FrequencyDomain_BodyGyroscope_mean_X |
| TimeDomain_BodyAccelerometerJerk_mean_Y | FrequencyDomain_BodyGyroscope_mean_Y |
| TimeDomain_BodyAccelerometerJerk_mean_Z | FrequencyDomain_BodyGyroscope_mean_Z |
| TimeDomain_BodyAccelerometerJerk_std_X | FrequencyDomain_BodyGyroscope_std_X |
| TimeDomain_BodyAccelerometerJerk_std_Y | FrequencyDomain_BodyGyroscope_std_Y |
| TimeDomain_BodyAccelerometerJerk_std_Z | FrequencyDomain_BodyGyroscope_std_Z |
| TimeDomain_BodyGyroscope_mean_X | FrequencyDomain_BodyAccelerometerMagnitude_mean |
| TimeDomain_BodyGyroscope_mean_Y | FrequencyDomain_BodyAccelerometerMagnitude_std |
| TimeDomain_BodyGyroscope_mean_Z | FrequencyDomain_BodyAccelerometerJerkMagnitude_mean |
| TimeDomain_BodyGyroscope_std_X | FrequencyDomain_BodyAccelerometerJerkMagnitude_std |
| TimeDomain_BodyGyroscope_std_Y | FrequencyDomain_BodyGyroscopeMagnitude_mean |
| TimeDomain_BodyGyroscope_std_Z | FrequencyDomain_BodyGyroscopeMagnitude_std |
| TimeDomain_BodyGyroscopeJerk_mean_X | FrequencyDomain_BodyGyroscopeJerkMagnitude_mean |
| TimeDomain_BodyGyroscopeJerk_mean_Y | FrequencyDomain_BodyGyroscopeJerkMagnitude_std |
| TimeDomain_BodyGyroscopeJerk_mean_Z |  |
| TimeDomain_BodyGyroscopeJerk_std_X |  |
| TimeDomain_BodyGyroscopeJerk_std_Y |  |
| TimeDomain_BodyGyroscopeJerk_std_Z |  |
| TimeDomain_BodyAccelerometerMagnitude_mean |  |
| TimeDomain_BodyAccelerometerMagnitude_std |  |
| TimeDomain_GravityAccelerometerMagnitude_mean |  |
| TimeDomain_GravityAccelerometerMagnitude_std |  |
| TimeDomain_BodyAccelerometerJerkMagnitude_mean |  |
| TimeDomain_BodyAccelerometerJerkMagnitude_std |  |
| TimeDomain_BodyGyroscopeMagnitude_mean |  |
| TimeDomain_BodyGyroscopeMagnitude_std |  |
| TimeDomain_BodyGyroscopeJerkMagnitude_mean |  |
| TimeDomain_BodyGyroscopeJerkMagnitude_std |  |



Final Tidy Data Set Description
-------------------------------
The final tidy data set is created from the intermediate data set.  It contains 180 rows and 68 variable.  The variable names are the same as those in the intermediate data set with the Group variable not included (thus giving 68 variables rather than the 69 in the intermediate set).

There is one row for each activity performed by each subject.  A total of 30 subjects each performing 6 activities yields the 180 rows.

The remaining 66 variables now represent the mean of all occurrences of that particular variable for each give combination of Subject and Activity.


Process for Creating Intermediate and Final Tidy Data Sets
----------------------------------------------------------
The script `run_analysis.R` creates a tidy dataset from the dataset at [https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip].

The script should be run from a directory that has the downloaded data in a subdirectory named "UCI HAR Dataset".  Note that this is the name of the directory the data is in within the referenced ZIP file.

1. The script first loads two top-level data files:
    + `features.txt`:  This file contains the names of the 561 measurement variables contained within the dataset.
    + `activity_labels.txt`:  This file contains the mapping between activity identifiers used in the data and their descriptive names.
<br>
<br>
2. The script next initializes an empty data frame and then reads in the raw data from the two subdirectories in the raw dataset:  "test" and "train".  This is done using a for-loop with the code dynamically generating the file path and file names appropriate to the directory currently being worked with.

    Three data files are loaded for each subdirectory:
    + `subject_{test,train}.txt`:  Contains the subject of each observation in the dataset.
    + `y_{test,train}.txt`:  Contains the activity performed during each observation in the dataset.
    + `X_{test,train}.txt`:  Contains the measurements collected / generated for each observation in the dataset.
    
    Note that each of these data file contains an identical number of rows (i.e. observations).
<br>
<br>
3. A temporary data frame is then built up, using cbind, from the data that was just loaded.  Data columns are added to this temporary frame as follows:
    + **Group**:  This is the subdirectory the data was read from (test or train).
    + **Subject**:  This is the data read from `subject_{test,train}.txt`
    + **Activity**:  This is the data read from y_`{test,train}.txt` but is added as a factor variable, mapped to the names read from `activity_labels.txt`
<br>
<br>
4. The next step is to add the actual observations data from the `X_{test,train}.txt` file.  Only the variables that are means or standard deviations are selected for inclusion in the tidy data set.  This is done by filtering on variable names (as defined in `features.txt`) that contain "-mean()" or "-std()".  Before the data is added to the temporary data frame, the variable names are cleaned from what were originally loaded from `features.txt`:
    + "()" are removed (as they are illegal in variable names)
    + '-' is replaced with '_' (which is also illegal in variable names)
    + The prefix "t" is expanded to "TimeDomain_"
    + The prefix "f" is expanded to to "FrequencyDomain_"
    + "Acc" is expanded to "Accelerometer"
    + "Gyro" is expanded to "Gyroscope"
    + "Mag" is expanded to "Magnitude"
    + "BodyBody" is correctd to be just "Body"
<br>
<br>
5. With the cleaned labels now applied, the selected observations data are added to the temporary data frame and the temporary data frame is then added (using rbind) to the variable tidyDataset that is being built up as the final tidy dataset.
<br>
<br>
6. A tidy version of the original dataset now exists, filtered to only include the variables of interest for the assignment.  The final step is to create a second tidy dataset that contains the average of each variable in this first tidy dataset for each activity and each subject.
<br>
<br>
This is done using the melt and dcast commands from the reshape2 library.  The just created dataset is first melted to change it from wide to narrow, organized around Subject and Activity.  The dcast function is then used to create a recasted dataset with all remaining variables now being the mean of the associated variable for each aggregated combination of Subject and Activity.
<br>
<br>
7. This new dataset is then written out to the file `tidy-dataset.txt` as the final output of this script.
